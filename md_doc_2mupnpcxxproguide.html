<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.12.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>mUPnP for C++: Programming Guide</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">mUPnP for C++
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.12.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',false,false,'search.php','Search',true);
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('md_doc_2mupnpcxxproguide.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<div><div class="header">
  <div class="headertitle"><div class="title">Programming Guide</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md0"></a></p>
<p>The programming guide describes how to create your UPnP™ devices and control points using <a class="el" href="namespacemUPnP.html">mUPnP</a> for C++. The guide is divided into the following sections.</p>
<h1><a class="anchor" id="autotoc_md1"></a>
Introduction</h1>
<p>UPnP™*[^1] architecture is based on open networking to enable discovery and control of networked devices and services, such as media servers and players at home.</p>
<p>UPnP™ architecture is based on many standard protocols, such as GENA, SSDP, SOAP, HTTPU and HTTP. Therefore you have to understand and implement these protocols to create your devices of UPnP™.</p>
<p><a class="el" href="namespacemUPnP.html">mUPnP</a> for C is a development package for UPnP™ developers. The <a class="el" href="namespacemUPnP.html">mUPnP</a> controls these protocols automatically, and supports to create your devices and control points quickly.</p>
<p>Please see the following site and documents to know about UPnP™ in more detail.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Document   </th><th class="markdownTableHeadNone">URL    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">UPnP™ Forum   </td><td class="markdownTableBodyNone"><a href="http://www.upnp.org/">http://www.upnp.org/</a>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Universal Plug and Play Device Architecture   </td><td class="markdownTableBodyNone"><a href="http://www.upnp.org/download/UPnPDA10_20000613.htm">http://www.upnp.org/download/UPnPDA10_20000613.htm</a>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Universal Plug and Play Vendor\'s Implementation Guide   </td><td class="markdownTableBodyNone"><a href="http://www.upnp.org/download/UPnP_Vendor_Implementation_Guide_Jan2001.htm">http://www.upnp.org/download/UPnP_Vendor_Implementation_Guide_Jan2001.htm</a>   </td></tr>
</table>
<h1><a class="anchor" id="autotoc_md2"></a>
Setup</h1>
<p>This section describes how to build and install the <a class="el" href="namespacemUPnP.html">mUPnP</a> package.</p>
<h2><a class="anchor" id="autotoc_md3"></a>
Package Contents</h2>
<p>The <a class="el" href="namespacemUPnP.html">mUPnP</a> package has the header files, the source files, the project files to build the package and the some samples. The files are included the following directories.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">File Type   </th><th class="markdownTableHeadNone"></th><th class="markdownTableHeadNone">Directory    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Source files   </td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone">mupnp-cc/src    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Header Files   </td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone">mupnp-cc/include    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Example files   </td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone">mupnp-cc/examples    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Project files   </td><td class="markdownTableBodyNone">Unix (Automake)   </td><td class="markdownTableBodyNone">mupnp-cc    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone">WindowsXP (Visual C / Sudio)   </td><td class="markdownTableBodyNone">mupnp-cc/*/win32/    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone">MacOSX (XCode)   </td><td class="markdownTableBodyNone">mupnp-cc/*/macosx   </td></tr>
</table>
<h2><a class="anchor" id="autotoc_md4"></a>
System Requirements</h2>
<p><a class="el" href="namespacemUPnP.html">mUPnP</a> supports the following XML parsers for UPnP SOAP requests. To compile <a class="el" href="namespacemUPnP.html">mUPnP</a>, you need to install the following packages on your platform.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Package   </th><th class="markdownTableHeadNone">URL    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">libxml2   </td><td class="markdownTableBodyNone"><a href="https://github.com/GNOME/libxml2">https://github.com/GNOME/libxml2</a>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Expat   </td><td class="markdownTableBodyNone"><a href="https://libexpat.github.io/">https://libexpat.github.io/</a>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Xerces-C++ XML Parser   </td><td class="markdownTableBodyNone"><a href="https://xerces.apache.org/xerces-c/">https://xerces.apache.org/xerces-c/</a>   </td></tr>
</table>
<p><a class="el" href="namespacemUPnP.html">mUPnP</a> uses libxml2 as the default XML parser, but you can use Expat as the parser by using a compiler option.</p>
<h3><a class="anchor" id="autotoc_md5"></a>
WindowsXP</h3>
<p>On Windows platform, you have to install latest Platform SDK and build on WindowsXP if you can. Please get the SDK and install in your platform.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Package   </th><th class="markdownTableHeadNone">URL    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Platform SDK   </td><td class="markdownTableBodyNone"><a href="http://www.microsoft.com/msdownload/platformsdk/sdkupdate/">http://www.microsoft.com/msdownload/platformsdk/sdkupdate/</a>   </td></tr>
</table>
<h2><a class="anchor" id="autotoc_md6"></a>
Building library and samples</h2>
<p>This sction describes how to build the <a class="el" href="namespacemUPnP.html">mUPnP</a> library and samples.</p>
<h4><a class="anchor" id="autotoc_md7"></a>
Unix</h4>
<p>On Unix platforms, you can build the library and samples using the following steps.</p>
<div class="fragment"><div class="line">cd mupnp-cc</div>
<div class="line">./configure</div>
<div class="line">make</div>
</div><!-- fragment --><p>For more information about configure options, please use <code>configure --help</code>.</p>
<h3><a class="anchor" id="autotoc_md8"></a>
Windows</h3>
<p>The <a class="el" href="namespacemUPnP.html">mUPnP</a> has platform projects for Visual C++ 6.0. Please check the platform directories, <code>mupnp-cc/*/win32/vc60</code>, to use the projects. On WindowsCE, <a class="el" href="namespacemUPnP.html">mUPnP</a> does not have platform projects, but a contributor has verified that the source code compiles normally.</p>
<h3><a class="anchor" id="autotoc_md9"></a>
MacOSX</h3>
<p>On MacOSX, you can build the library and samples using the same steps as the Unix platform or using Xcode or Project Builder projects. Please check the platform directories to use the projects, <code>mupnp-cc/*/macosx</code>.</p>
<h1><a class="anchor" id="autotoc_md10"></a>
Device</h1>
<p>UPnP™ device is a networked device that supports the UPnP™ architecture. The device has some embedded devices and services, and the services have some actions and state variables. The device is created as a root device, and the root device is active using <a class="el" href="namespacemUPnP.html">mUPnP</a> for C.</p>
<p>This section describes how to create your UPnP™ device using <a class="el" href="namespacemUPnP.html">mUPnP</a> for C.</p>
<h2><a class="anchor" id="autotoc_md11"></a>
Class Overview</h2>
<p>The following static structure diagram is related classes of <a class="el" href="namespacemUPnP.html">mUPnP</a> to create your device of UPnP™. The device has some embedded devices and services, and the services have some actions and state variables.</p>
<div class="image">
<img src="device-class-overview.png" alt=""/>
</div>
    <p>The above static structure diagram is modified simplify to explain.</p>
<h2><a class="anchor" id="autotoc_md12"></a>
Description</h2>
<p>At first, you have to make some description files of your devices and the services when you want to create your UPnP™ device..</p>
<div class="image">
<img src="device-description.png" alt=""/>
</div>
    <p>The description of the root device should not have URLBase element because the element is added automatically when the device is created using the description.</p>
<p>The service descriptions are required to create a device, but the presentationURL and the iconList are recommended option. Please see UPnP™ specifications about the description format in more detail.</p>
<h2><a class="anchor" id="autotoc_md13"></a>
Initiating</h2>
<p>To create a UPnP™ device, create a instance of Device class with the root description file. The created device is a root device, and only root device can be active using <code>Device::start()</code>. The device is announced to the UPnP™ network when the device is started. The following shows an example of the initiating device.</p>
<div class="fragment"><div class="line">#include &lt;cybergarage/upnp/mUPnP.h&gt;</div>
<div class="line">using namespace mUPnP;</div>
<div class="line">....</div>
<div class="line">const char *descriptionFileName = &quot;description/description.xml&quot;;</div>
<div class="line">Try {</div>
<div class="line">    Device *upnpDev = new Device(descriptionFileName);</div>
<div class="line">    ....</div>
<div class="line">    upnpDev-&gt;start();</div>
<div class="line">}</div>
<div class="line">catch (InvalidDescriptionException e){</div>
<div class="line">    const char *errMsg = e.getMessage();</div>
<div class="line">    cout &lt;&lt; “InvalidDescriptionException = ” &lt;&lt; errMsg &lt;&lt; endl;</div>
<div class="line">}</div>
</div><!-- fragment --><p>The InvalidDescriptionException is occurred when the description is invalid. Use the getMessage() to know the exception reason in more detail.</p>
<p>Alternatively, you can load the descriptions using Device::loadDescription() and Service::loadSCPD() instead of the description files as the following. The loading methods doesn’t occur the exception.</p>
<div class="fragment"><div class="line">const char DEVICE_DESCRIPTION[] =</div>
<div class="line">    &quot;&lt;?xml version=\&quot;1.0\&quot; ?&gt;\n&quot;</div>
<div class="line">    &quot;&lt;root xmlns=\&quot;urn:schemas-upnp-org:device-1-0\&quot;&gt;\n&quot;</div>
<div class="line">    ....</div>
<div class="line">    &quot;&lt;/root&gt;&quot;;</div>
<div class="line"> </div>
<div class="line">const char SERVICE_DESCRIPTION[] =</div>
<div class="line">    &quot;&lt;?xml version=\&quot;1.0\&quot;?&gt;\n&quot;</div>
<div class="line">    &quot;&lt;scpd xmlns=\&quot;urn:schemas-upnp-org:service-1-0\&quot; &gt;\n&quot;</div>
<div class="line">    ....</div>
<div class="line">    “&lt;/scpd&gt;”;</div>
<div class="line"> </div>
<div class="line">Device *upnpDev = new Device();</div>
<div class="line">bool descSuccess = upnpDev-&gt;loadDescription(DEVICE_DESCRIPTION);</div>
<div class="line">Service *upnpService = getService(&quot;urn:schemas-upnp-org:service-1-0&quot;);</div>
<div class="line">bool scpdSuccess = upnpService-&gt;loadSCPD(SERVICE_DESCRIPTION);</div>
</div><!-- fragment --><p>The active root device has some server processes, and returns the responses automatically when a control points sends a request to the device. For example, the device has a HTTP server to return the description files when a control point gets the description file. The device searches an available port for the HTTP server automatically on the machine when the device is started.</p>
<div class="image">
<img src="device-ports.png" alt=""/>
</div>
    <p>The root device is created with the following default parameters, you can change the parameters using the following methods before the root device is started.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone"></th><th class="markdownTableHeadNone">Parameter   </th><th class="markdownTableHeadNone">Default   </th><th class="markdownTableHeadNone">Method    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">1   </td><td class="markdownTableBodyNone">HTTP port   </td><td class="markdownTableBodyNone">4004   </td><td class="markdownTableBodyNone">Device::setHTTPPort()    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">2   </td><td class="markdownTableBodyNone">Description URI   </td><td class="markdownTableBodyNone">/description.xml   </td><td class="markdownTableBodyNone">Device::setDescriptionURI()    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">3   </td><td class="markdownTableBodyNone">Lease time   </td><td class="markdownTableBodyNone">1800   </td><td class="markdownTableBodyNone">Device::setLeaseTime   </td></tr>
</table>
<h2><a class="anchor" id="autotoc_md14"></a>
Notify</h2>
<p>Your device is announced using <code>Device::start()</code> to the UPnP™ network using a notify message with ssdp::alive automatically when the device is started. When device is stopped using <code>Device::stop()</code>, a notify message is posted with ssdp::byebye. You can announce the notify messages using <code>Device::announce()</code> and Device::byebye().</p>
<div class="image">
<img src="device-notify.png" alt=""/>
</div>
    <p>When a control point sends a search request with M-SEARCH to the UPnP™ network, the active device send the search response to the control point automatically. The device repeats the announcement in the lease time automatically.</p>
<h2><a class="anchor" id="autotoc_md15"></a>
Embedded Devices</h2>
<p>The devices may have some embedded devices. Use <code>Device::getDeviceList()</code> to get the embedded device list. The following example outputs friendly names of all embedded devices in the device.</p>
<div class="fragment"><div class="line">void printDevice(Device *dev)</div>
<div class="line">{</div>
<div class="line">    counst char *devName = dev-&gt;getFriendlyName();</div>
<div class="line">    cout &lt;&lt; devName &lt;&lt; endl;</div>
<div class="line">    DeviceList *childDevList = dev-&gt;getDeviceList();</div>
<div class="line">    int nChildDevs = childDevList-&gt;size();</div>
<div class="line">    for (int ｎ =0; ｎ &lt;nChildDevs; ｎ ++) {</div>
<div class="line">        Device *childDev = childDevList -&gt;getDevice(n);</div>
<div class="line">        printDevice(childDev);</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line">....</div>
<div class="line">Dev *rootDev = ....;</div>
<div class="line">....</div>
<div class="line">DeviceList *childDevList = rootDev-&gt;getDeviceList();</div>
<div class="line">int childDevs = childDevList-&gt;size();</div>
<div class="line">for (int n=0; n&lt; childDevs; n++) {</div>
<div class="line">    Device *childDev = rootDevList-&gt;getDevice(n);</div>
<div class="line">    printDevice(childDev);</div>
<div class="line">}</div>
</div><!-- fragment --><p>You can find a embedded device by the friendly name or UDN using <code>Device::getDevice()</code>. The following example gets a embedded device by the friendly name.</p>
<div class="fragment"><div class="line">Device *homeServerDev ....</div>
<div class="line">Device *musicDev = homeServerDev-&gt;getDevice(“music”);</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md16"></a>
Service</h2>
<p>Use <code>Device::getServiceList()</code> to access embedded services of the device. The service may has some actions and state variables. Use <code>Service::getActionList()</code> to get the actions, and use <code>Service::getServiceStateTable()</code> to the state variables by the name. The following example outputs the all actions and state variables in a device.</p>
<div class="fragment"><div class="line">Device *dev ....</div>
<div class="line">ServiceList *serviceList = dev-&gt;getServiceList();</div>
<div class="line">int serviceCnt = serviceList-&gt;size();</div>
<div class="line">for (int n=0; n&lt;serviceCnt; n++) {</div>
<div class="line">    Service *service = serviceList-&gt;getService(n);</div>
<div class="line">    ActionList *actionList = service-&gt;getActionList();</div>
<div class="line">    int actionCnt = actionList-&gt;size();</div>
<div class="line">    for (int i=0; i&lt;actionCnt; i++) {</div>
<div class="line">        Action *action = actionList-&gt;getAction(i);</div>
<div class="line">        cout &lt;&lt; “action [“ &lt;&lt; i &lt;&lt; “] = “&lt;&lt; action-&gt;getName() &lt;&lt; endl;</div>
<div class="line">    }</div>
<div class="line">    ServiceStateTable *stateTable = service-&gt; getServiceStateTable ();</div>
<div class="line">    int varCnt = stateTable-&gt;size();</div>
<div class="line">    for (int i=0; i&lt;actionCnt; i++) {</div>
<div class="line">        StateVariable *stateVar = stateTable-&gt;getServiceStateVariable(i);</div>
<div class="line">        cout &lt;&lt; “stateVar [“ &lt;&lt; i &lt;&lt; “] = “ &lt;&lt; stateVar-&gt;getName() &lt;&lt; endl;</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><p>You can find a service in the device by the service ID using <code>Device::getService()</code>, and you can find an action or state variable in the service by name too. Use <code>Device::getAction()</code> or <code>Service::getAction()</code> to find the action, and use <code>Device::getStateariable()</code> or <code>Service::getStateVariable()</code> to find the state variable. The following example gets a service, a action and a state variable in a device by name.</p>
<div class="fragment"><div class="line">Device *clockDev ....</div>
<div class="line">Service *timerSev = clockDev-&gt;getService(“timer”);</div>
<div class="line">Action *getTimeAct = clockDev-&gt;getAction(“GetTime”);</div>
<div class="line">StateVariable *timeStat = clockDev-&gt;getStateVariable(“time”);</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md17"></a>
Control</h2>
<p>To receive action control events from control points, the device needs to implement the ActionListener interface. The listener have to implement a actionControlReceived() that has the action and argument list parameter. The input arguments has the passed values from the control point, set the response values in the output arguments and return true when the request is valid. Otherwise return a false when the request is invalid. UPnPError response is returned to the control point automatically when the returned value is false or the device has no the interface. The UPnPError is INVALID_ACTION as default, but use <code>Action::setSetStatus()</code> to return other UPnP errors.</p>
<p>To receive query control events from control points, the device needs to implement the QueryListener interface.</p>
<p>The listener have to implement a <code>queryControlReceived()</code> that has the service variable parameter and return a true when the request is valid. Otherwise return a false when the request is invalid. UPnPError response is returned to the control point automatically when the returned value is false or the device has no the interface. The UPnPError is INVALID_ACTION as default, but use <code>ServiceVariable::setSetStatus()</code> to return other UPnP errors.</p>
<p>The following sample is a clock device. The device executes two action control requests and a query control request.</p>
<div class="fragment"><div class="line">class ClockDevice : public Device, public ActionListener, public QueryListener</div>
<div class="line">{</div>
<div class="line">public:</div>
<div class="line">    ClockDevice() : Device(“/clock/www/description.xml”) {</div>
<div class="line">        Action *setTimeAction = getAction(“SetTime”);</div>
<div class="line">        setTimeAction-&gt;setActionListener(this);</div>
<div class="line">        Action *getTimeAction = getAction(“GetTime”);</div>
<div class="line">        getTimeAction-&gt;setActionListener(this);</div>
<div class="line">        StateVariable *timeVar = getStateVariable(“Timer”);</div>
<div class="line">        timeVar-&gt;setQueryListener(this);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    bool actionControlRecieved(Action *action) {</div>
<div class="line">        ArgumentList *argList = action-&gt;getArgumentList();</div>
<div class="line">        const char *actionName = action-&gt;getName();</div>
<div class="line">        if (strcmp(actionName, &quot;SetTime&quot;) == 0) {</div>
<div class="line">            Argument *inTime = argList-&gt;getArgument(“time”);</div>
<div class="line">            const char *timeValue = inTime-&gt;getValue();</div>
<div class="line">            If (timeValue == NULL || strlen(timeValue) &lt;= 0)</div>
<div class="line">            return false;</div>
<div class="line">            ....</div>
<div class="line">            Argument *outResult = argList-&gt;getArgument(“result”);</div>
<div class="line">            arg-&gt;setValue(“TRUE”);</div>
<div class="line">            return true;</div>
<div class="line">        }</div>
<div class="line">        else if (strcmp(actionName, “GetTime”) == 0) {</div>
<div class="line">            const char *currTimeStr = …</div>
<div class="line">            Argument *currTimeArg = argList-&gt;getArgument(“currTime”);</div>
<div class="line">            currTimeArg-&gt;setValue(currTimeStrs);</div>
<div class="line">            return true;</div>
<div class="line">        }</div>
<div class="line">        action-&gt;setStatus(UPnP::INVALID_ACTION, “…..”);</div>
<div class="line">        return false;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    bool queryControlReceived(StatusVariable *stateVar) {</div>
<div class="line">        if (strcmp(varName, “Time”) == 0) {</div>
<div class="line">            cont char *currTimeStr = ….;</div>
<div class="line">            stateVar.setValue(currTimeStr);</div>
<div class="line">            return true;</div>
<div class="line">        }</div>
<div class="line">        stateVar-&gt;setStatus(UPnP::INVALID_VAR, “…..”);</div>
<div class="line">        return false;</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><p>Use <code>Device::setActionListner()</code> or <code>Service::setActionListnerer()</code> to add a listener into all control actions in a device or a service. Use <code>Device::setQueryListner()</code> or <code>Service::setQueryListner()</code> to add a listener into all query actions in a device or a service. The following sample sets a listener into all actions in a device.</p>
<div class="fragment"><div class="line">class ClockDevice : public Device, public ActionListener, public QueryListener {</div>
<div class="line">public:</div>
<div class="line">    ClockDevice() : Device(“/clock/www/description.xml”) {</div>
<div class="line">        setActionListner(this);</div>
<div class="line">        setQueryListener (this);</div>
<div class="line">    }</div>
<div class="line">    bool actionControlRecieved(Action *action) {</div>
<div class="line">        ....</div>
<div class="line">    }</div>
<div class="line">    bool queryControlReceived(StateVariable *stateVar) {</div>
<div class="line">        ....</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md18"></a>
Event</h2>
<p>The control point may subscribe some events of the device. You don’t need manage the subscription messages from control points because the device manages the subscription messages automatically. For example, the device adds a control point into the subscriber list when the control point sends a subscription message to the device, or the device removes the control point from the subscriber list when the control point sends a unsubscription message.</p>
<p>Use <code>ServiceStateVariable::setValue()</code> when you want to send the state to the subscribers. The event is sent to the subscribers automatically when the state variable is updated using <code>ServiceStateVariable::setValue()</code>. The following example updates a state variable, and the updated state is distributed to the subscribers automatically.</p>
<div class="fragment"><div class="line">Device *clockDevice = ....</div>
<div class="line">StateVariable timeVar = clockDevice-&gt;getStateVariable(&quot;Time&quot;);</div>
<div class="line">const char *timeStr = ....</div>
<div class="line">timeVar-&gt;setValue(timeStr);</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md19"></a>
Control Point</h1>
<p>UPnP™ control point is a networked device that controls the UPnP™ devices in the UPnP™ network. The control point has some root devices in the UPnP™ network, and the control point can send action or query control messages to the discovered devices. The control point is created as a root device, and the root device is active using <a class="el" href="namespacemUPnP.html">mUPnP</a> for C++.</p>
<p>This section describes how to create your UPnP™ control point using <a class="el" href="namespacemUPnP.html">mUPnP</a> for C.</p>
<h2><a class="anchor" id="autotoc_md20"></a>
Class Overview</h2>
<p>The following static structure diagram is related classes of <a class="el" href="namespacemUPnP.html">mUPnP</a> to create your control point of UPnP™. The control point has some root devices in the UPnP™ network.</p>
<div class="image">
<img src="ctrlpoint-class-overview.png" alt=""/>
</div>
    <p>To create a UPnP™ control point, create a instance of ControlPoint class. Use ControlPoint::start() to active the contol point. The control point multicasts a discovery message searching for all devices to the UPnP™ network automatically when the control point is active.</p>
<div class="fragment"><div class="line">#include &lt;cybergarage/upnp/mUPnP.h&gt;</div>
<div class="line">using namespace mUPnP;</div>
<div class="line">....</div>
<div class="line">ControlPoint *ctrlPoint = new ControlPoint();</div>
<div class="line">....</div>
<div class="line">ctrlPoint-&gt;start();</div>
</div><!-- fragment --><p>The active control point has some server processes, and returns the responses automatically when other UPnP™ devices send the messages to the control point. For example, the control point has a SSDP server to get M-</p>
<p>SEARCH responses, and the control point searches a available port for the SSDP server automatically on the machine when the control point is started.</p>
<p>The control point is created with the following default parameters. You can change the parameters using the following methods before the control point is started.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone"></th><th class="markdownTableHeadNone">Parameter   </th><th class="markdownTableHeadNone">Default   </th><th class="markdownTableHeadNone">Function    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">1   </td><td class="markdownTableBodyNone">HTTP port   </td><td class="markdownTableBodyNone">39500   </td><td class="markdownTableBodyNone">CotrolPoint::setHTTPPort()    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">2   </td><td class="markdownTableBodyNone">SSDP port   </td><td class="markdownTableBodyNone">39400   </td><td class="markdownTableBodyNone">CotrolPoint::setSSDPPort()    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">3   </td><td class="markdownTableBodyNone">Subscription URI   </td><td class="markdownTableBodyNone">/eventSub   </td><td class="markdownTableBodyNone">CotrolPoint::setEventSubURI()    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">4   </td><td class="markdownTableBodyNone">Search Response   </td><td class="markdownTableBodyNone">3   </td><td class="markdownTableBodyNone">CotrolPoint::setSerchMx()   </td></tr>
</table>
<p>4.3 Notify</p>
<p>The control point receives notify events from devices in the UPnP™ network, and the devices are added or removed form the control point automatically. The expired device is removed from the device list of the control point automatically too. You don’t manage the notify events, but you can receive the event to implement the NotifyListener interface. The following sample receives the notify messages.</p>
<div class="fragment"><div class="line">class MyCtrlPoint : public ControlPoint, public NotifyListener {</div>
<div class="line">public:</div>
<div class="line">    MyCtrlPoint() {</div>
<div class="line">        ....</div>
<div class="line">        addNotifyListener(this);</div>
<div class="line">        start();</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    void deviceNotifyReceived(SSDPPacket *ssdpPacket)</div>
<div class="line">    {</div>
<div class="line">        string use, nt, nts, location;</div>
<div class="line">        const char *uuid = ssdpPacket.getUSN(usn);</div>
<div class="line">        const char *target = ssdpPacket.getNT(nt);</div>
<div class="line">        const char *subType = ssdpPacket.getNTS(nts);</div>
<div class="line">        const char *where = ssdpPacket.getLocation(location);</div>
<div class="line">        ....</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><p>To know only the added and removed device, you may use the following interface, DeviceChangeListener.</p>
<div class="fragment"><div class="line">class MyCtrlPoint : public ControlPoint, public DeviceChangeListener {</div>
<div class="line">public:</div>
<div class="line">    MyCtrlPoint() {</div>
<div class="line">        ....</div>
<div class="line">        addDeviceChangeListener (this);</div>
<div class="line">        start();</div>
<div class="line">    }</div>
<div class="line">    void deviceAdded (Device *dev) {</div>
<div class="line">        ....</div>
<div class="line">    }</div>
<div class="line">    void deviceRemoved(Device *dev) {</div>
<div class="line">        ....</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md21"></a>
Search</h2>
<p>You can update the device lists using <code>ControlPoint::search()</code>. The discovered root devices are added to the control point automatically, and you can receive the response to implement the SearchResponseListener interface. The following sample receives the notify messages.</p>
<div class="fragment"><div class="line">class MyCtrlPoint : public ControlPoint, public SearchResponseListener {</div>
<div class="line">public:</div>
<div class="line">    MyCtrlPoint() {</div>
<div class="line">        ....</div>
<div class="line">        addSearchResponseListener(this);</div>
<div class="line">        start();</div>
<div class="line">        ....</div>
<div class="line">        search(“upnp:rootdevice”);</div>
<div class="line">    }</div>
<div class="line">    void deviceSearchResponseReceived(SSDPPacket *ssdpPacket)</div>
<div class="line">    {</div>
<div class="line">        string usn, st, location;</div>
<div class="line">        const char *uuid = ssdpPacket.getUSN(usn);</div>
<div class="line">        const char *target = ssdpPacket.getST(st);</div>
<div class="line">        const char *where = ssdpPacket.getLocation(location);</div>
<div class="line">        ....</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md22"></a>
Root Devices</h2>
<p>Use <code>ControlPoint::getDeviceList()</code> that returns only root devices to get the discovered device list. The following example outputs friendly names of the root devices.</p>
<div class="fragment"><div class="line">ControlPoint *ctrlPoint = new ControlPoint();</div>
<div class="line">....</div>
<div class="line">ctrlPoint-&gt;start();</div>
<div class="line">....</div>
<div class="line">DeviceList *rootDevList = ctrlPoint-&gt;getDeviceList();</div>
<div class="line">int nRootDevs = rootDevList-&gt;size();</div>
<div class="line">for (int n=0; n&lt;nRootDevs; n++) {</div>
<div class="line">    Device *dev = rootDevList-&gt;getDevice(n);</div>
<div class="line">    const char *devName = dev-&gt;getFriendlyName();</div>
<div class="line">    cout &lt;&lt; “[“ &lt;&lt; n &lt;&lt; “] = ” &lt;&lt; devName &lt;&lt; endl;</div>
<div class="line">}</div>
</div><!-- fragment --><p>You can find a root device by the friendly name, the device type, or the UDN using ControlPoint::getDevice(). The following example gets a root device by the friendly name.</p>
<div class="fragment"><div class="line">ControlPoint *ctrlPoint = new ControlPoint();</div>
<div class="line">....</div>
<div class="line">ctrlPoint-&gt;start();</div>
<div class="line">....</div>
<div class="line">Device *homeServerDev = ctrlPoint-&gt;getDevice(“xxxx-home-server”);</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md23"></a>
Control</h2>
<p>The control point can send action or query control messages to the discovered devices. To send the action control message, use <code>Action::setArgumentValue()</code> and <code>Action::postControlAction()</code>. You should set the action values to the all input arguments, and the output argument values is ignored if you set. The following sample posts a action control request that sets a new time, and output the response result.</p>
<div class="fragment"><div class="line">Device *clockDev = ....</div>
<div class="line">Action *setTimeAct = clockDev-&gt;getAction(“SetTime”);</div>
<div class="line">char *newTime = ....</div>
<div class="line">setTimeAct-&gt;setArgumentValue(“time”, newTime);</div>
<div class="line">if (setTimeAct-&gt;postControlAction() == true) {</div>
<div class="line">    ArgumentList *outArgList = setTimeAct-&gt;getOutputArgumentList();</div>
<div class="line">    int nOutArgs = outArgList-&gt;size();</div>
<div class="line">    for (int n=0; n&lt;nOutArgs; n++) {</div>
<div class="line">        Argument *outArg = outArgList-&gt;getArgument(n);</div>
<div class="line">        const char *name = outArg-&gt;getName();</div>
<div class="line">        const char *value = outArg-&gt;getValue();</div>
<div class="line">        ....</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line">else {</div>
<div class="line">    UPnPStatus *err = setTimeAct-&gt;getUPnPStatus();</div>
<div class="line">    System.out.println(&quot;Error Code = &quot; + err-&gt;getCode());</div>
<div class="line">    System.out.println(&quot;Error Desc = &quot; + err-&gt;getDescription());</div>
<div class="line">}</div>
</div><!-- fragment --><p>To send the query control message, use <code>StateVariable::postQueryControl()</code>. The following sample posts a query control request, and output the return value.</p>
<div class="fragment"><div class="line">Device *clockDev = ....</div>
<div class="line">StateVariable *timeStateVar = clockDev-&gt;getStateVariable(“time”);</div>
<div class="line">if (timeStateVar-&gt;postQueryControl() == true) {</div>
<div class="line">    String value = timeStateVar.getValue();</div>
<div class="line">    ....</div>
<div class="line">}</div>
<div class="line">else {</div>
<div class="line">    UPnPStatus *err = timeStateVar-&gt;getUPnPStatus();</div>
<div class="line">    System.out.println(&quot;Error Code = &quot; + err-&gt;getCode());</div>
<div class="line">    System.out.println(&quot;Error Desc = &quot; + err-&gt;getDescription());</div>
<div class="line">}</div>
</div><!-- fragment --><p>Use <code>Argument::getRelatedStateVariable()</code> to get the related StatiVariable of the argument, and use <code>StateVariable::getAllowedValueRange()</code> or <code>getAllowedValueList()</code> to get the the allowed value range or list.</p>
<div class="fragment"><div class="line">Device *clockDev = ....</div>
<div class="line">Action *timeAct = clockDev-&gt;getAction(“SetTime”);</div>
<div class="line">Argument *timeArg = timeAct-&gt;getArgument(“time”);</div>
<div class="line">StataVariable *stateVar = timeArg-&gt;getRelatedStateVariable();</div>
<div class="line">if (stateVar != NULL) {</div>
<div class="line">    if (stateVar-&gt;hasAllowedValueRange() == true) {</div>
<div class="line">        AllowedValueRange *valRange = stateVar-&gt;getAllowedValueRange();</div>
<div class="line">        ....</div>
<div class="line">    }</div>
<div class="line">    if (stateVar-&gt;hasAllowedValueList() == true) {</div>
<div class="line">        AllowedValueList *valList = stateVar-&gt;getAllowedValueList ();</div>
<div class="line">        ....</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md24"></a>
Event</h2>
<p>The control point can subscribe events of the discovered devices, get the state changes of the services Use <code>ControlPoint::subscribe()</code> and implement the EventListener interface. The listener have to implement a eventNotifyReceived().</p>
<div class="fragment"><div class="line">MyControlPoint : public ControlPoint, public EventListener {</div>
<div class="line">public:</div>
<div class="line">    MyControlPoint() {</div>
<div class="line">        ....</div>
<div class="line">        addEventListener(this);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    void eventNotifyReceived(const char *uuid, long seq, const char *name, const char *value) {</div>
<div class="line">        ....</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><p>The <code>ControlPoint::subscribe()</code> returns true when the subscription is accepted from the service, and you can get the subscription id and timeout.</p>
<div class="fragment"><div class="line">ControlPoint *ctrlPoint = .....</div>
<div class="line">Device *clockDev = ctrlPoint-&gt;getDevice(“xxxx-clock”);</div>
<div class="line">Service *timeService = clockDev-&gt;getService(“time:1”);</div>
<div class="line">bool subRet = ctrlPoint-&gt;subscribe(timeService);</div>
<div class="line">if (subRet == true) {</div>
<div class="line">    const char *sid = timeService-&gt;getSID();</div>
<div class="line">    long timeout = timeService-&gt;getTimeout();</div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md25"></a>
Networked Media Product Requirements</h1>
<p>The Intel Networked Media Product Requirements (NMPR) is a implementation guidelins for digital networked devices. Please see the following page about NMPR in more detail.</p>
<ul>
<li><a href="http://www.intel.com/technology/dhdevnet/">Intel Develper Network for Digital Home</a></li>
</ul>
<h2><a class="anchor" id="autotoc_md26"></a>
NMPR Mode</h2>
<p>The NMPR features are include Device and ControlPoint class of the <a class="el" href="namespacemUPnP.html">mUPnP</a>, but the features are not available as default. Please use <code>Device::setNMPRMode()</code> and <code>ControlPoint::setNMPRMode()</code> as the following</p>
<div class="fragment"><div class="line">ControlPoint *ctrlPoint = .....</div>
<div class="line">ctrlPoint-&gt;setNMPRMode(true);</div>
<div class="line">ctrlPoint-&gt;start();</div>
<div class="line"> </div>
<div class="line">Device *device = …</div>
<div class="line">device-&gt;setNMPRMode(true);</div>
<div class="line">device-&gt;setWirelessMode(true); // if your device is on wireless network.</div>
<div class="line">device-&gt;start().;</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md27"></a>
Implementaion Status</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">UPnP Technology Requirements   </th><th class="markdownTableHeadNone">M/S/O   </th><th class="markdownTableHeadNone">Support   </th><th class="markdownTableHeadNone">Default   </th><th class="markdownTableHeadNone">NMPR   </th><th class="markdownTableHeadNone">Detail    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">&lt;Device Discovery and Control&gt;   </td><td class="markdownTableBodyNone">M   </td><td class="markdownTableBodyNone">Y   </td><td class="markdownTableBodyNone">O   </td><td class="markdownTableBodyNone">O   </td><td class="markdownTableBodyNone">The NMPR tag is added automatically when the NMPR mode is true.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">&lt;UPnP iNMPR’03 Description Tag&gt;   </td><td class="markdownTableBodyNone">M   </td><td class="markdownTableBodyNone">Y   </td><td class="markdownTableBodyNone">X   </td><td class="markdownTableBodyNone">O   </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">&lt;UPnP Discovery Flood Control&gt;   </td><td class="markdownTableBodyNone">M   </td><td class="markdownTableBodyNone">Y   </td><td class="markdownTableBodyNone">O   </td><td class="markdownTableBodyNone">O   </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">&lt;UPnP SSDP Default Port&gt;   </td><td class="markdownTableBodyNone">M   </td><td class="markdownTableBodyNone">Y   </td><td class="markdownTableBodyNone">O   </td><td class="markdownTableBodyNone">O   </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">&lt;UPnP Device Advertisement Frequency&gt;   </td><td class="markdownTableBodyNone">M   </td><td class="markdownTableBodyNone">Y   </td><td class="markdownTableBodyNone">O   </td><td class="markdownTableBodyNone">O   </td><td class="markdownTableBodyNone">Use Device::setWirelessMode() too.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">&lt;UPnP Discovery over Wireless&gt;   </td><td class="markdownTableBodyNone">M   </td><td class="markdownTableBodyNone">Y   </td><td class="markdownTableBodyNone">X   </td><td class="markdownTableBodyNone">O   </td><td class="markdownTableBodyNone">The subscription is update automatically when the NMPR mode is true.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">&lt;UPnP Device Sync Rules&gt;   </td><td class="markdownTableBodyNone">M   </td><td class="markdownTableBodyNone">Y   </td><td class="markdownTableBodyNone">X   </td><td class="markdownTableBodyNone">O   </td><td class="markdownTableBodyNone">Depend on your platform and device implemenation.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">&lt;UPnP Auto-IP Support&gt;   </td><td class="markdownTableBodyNone">M   </td><td class="markdownTableBodyNone">-   </td><td class="markdownTableBodyNone">-   </td><td class="markdownTableBodyNone">-   </td><td class="markdownTableBodyNone">Not support to the dynamic changes in network configuration.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">&lt;UPnP Device Reset&gt;   </td><td class="markdownTableBodyNone">M   </td><td class="markdownTableBodyNone">N   </td><td class="markdownTableBodyNone">X   </td><td class="markdownTableBodyNone">X   </td><td class="markdownTableBodyNone">The inavtivity connection close and HTTP HEAD request are not supported yet.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">&lt;UPnP HTTP Support and General Rules&gt;   </td><td class="markdownTableBodyNone">M   </td><td class="markdownTableBodyNone">N   </td><td class="markdownTableBodyNone">X   </td><td class="markdownTableBodyNone">X   </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">&lt;UPnP HTTP 1.0 Rules&gt;   </td><td class="markdownTableBodyNone">M   </td><td class="markdownTableBodyNone">Y   </td><td class="markdownTableBodyNone">O   </td><td class="markdownTableBodyNone">O   </td><td class="markdownTableBodyNone">Only HTTP 1.0 is supported.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">&lt;UPnP HTTP 1.1 Rules&gt;   </td><td class="markdownTableBodyNone">M   </td><td class="markdownTableBodyNone">N   </td><td class="markdownTableBodyNone">X   </td><td class="markdownTableBodyNone">X   </td><td class="markdownTableBodyNone">The HTTP pipelining is not supported yet.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">&lt;UPnP HTTP Pipelining General Rules&gt;   </td><td class="markdownTableBodyNone">M   </td><td class="markdownTableBodyNone">N   </td><td class="markdownTableBodyNone">X   </td><td class="markdownTableBodyNone">X   </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">&lt;UPnP Unknown Tag/Field Decoding&gt;   </td><td class="markdownTableBodyNone">M   </td><td class="markdownTableBodyNone">Y   </td><td class="markdownTableBodyNone">O   </td><td class="markdownTableBodyNone">O   </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">&lt;UPnP Error Codes&gt;   </td><td class="markdownTableBodyNone">M   </td><td class="markdownTableBodyNone">-   </td><td class="markdownTableBodyNone">-   </td><td class="markdownTableBodyNone">-   </td><td class="markdownTableBodyNone">Depend on your device implementation.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">&lt;UPnP Device Responsiveness&gt;   </td><td class="markdownTableBodyNone">M   </td><td class="markdownTableBodyNone">-   </td><td class="markdownTableBodyNone">-   </td><td class="markdownTableBodyNone">-   </td><td class="markdownTableBodyNone">Depend on your device implementation.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">&lt;UPnP SOAP Packet Size&gt;   </td><td class="markdownTableBodyNone">S   </td><td class="markdownTableBodyNone">Y   </td><td class="markdownTableBodyNone">O   </td><td class="markdownTableBodyNone">O   </td><td class="markdownTableBodyNone">There is no limitation for the embedded devices.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">&lt;UPnP Embedded Device Support&gt;   </td><td class="markdownTableBodyNone">M   </td><td class="markdownTableBodyNone">N   </td><td class="markdownTableBodyNone">X   </td><td class="markdownTableBodyNone">X   </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">&lt;UPnP Multi-Homing Rules&gt;   </td><td class="markdownTableBodyNone">M   </td><td class="markdownTableBodyNone">Y   </td><td class="markdownTableBodyNone">O   </td><td class="markdownTableBodyNone">O   </td><td class="markdownTableBodyNone">Depend on your device implementation. The UPnP errors are returned automatically when the services are defined and not implemented.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">&lt;UPnP Service Descriptions Rules&gt;   </td><td class="markdownTableBodyNone">M   </td><td class="markdownTableBodyNone">-   </td><td class="markdownTableBodyNone">-   </td><td class="markdownTableBodyNone">-   </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">&lt;UPnP Subscription Handling&gt;   </td><td class="markdownTableBodyNone">M   </td><td class="markdownTableBodyNone">Y   </td><td class="markdownTableBodyNone">O   </td><td class="markdownTableBodyNone">O   </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">&lt;UPnP Event Notification Handling&gt;   </td><td class="markdownTableBodyNone">M   </td><td class="markdownTableBodyNone">Y   </td><td class="markdownTableBodyNone">O   </td><td class="markdownTableBodyNone">O   </td><td class="markdownTableBodyNone">Depend on implementation.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">&lt;UPnP Device Icons&gt;   </td><td class="markdownTableBodyNone">M   </td><td class="markdownTableBodyNone">-   </td><td class="markdownTableBodyNone">-   </td><td class="markdownTableBodyNone">-   </td><td class="markdownTableBodyNone">Depend on implementation.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">&lt;UPnP PNG Icon Recommendations&gt;   </td><td class="markdownTableBodyNone">M   </td><td class="markdownTableBodyNone">-   </td><td class="markdownTableBodyNone">-   </td><td class="markdownTableBodyNone">-   </td><td class="markdownTableBodyNone">Depend on implementation.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">&lt;UPnP Device Icon Support for .ICO&gt;   </td><td class="markdownTableBodyNone">S   </td><td class="markdownTableBodyNone">-   </td><td class="markdownTableBodyNone">-   </td><td class="markdownTableBodyNone">-   </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">&lt;UPnP UTF-8 Support&gt;   </td><td class="markdownTableBodyNone">M   </td><td class="markdownTableBodyNone">Y   </td><td class="markdownTableBodyNone">O   </td><td class="markdownTableBodyNone">O   </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">&lt;UPnP XML Comments&gt;   </td><td class="markdownTableBodyNone">M   </td><td class="markdownTableBodyNone">Y   </td><td class="markdownTableBodyNone">O   </td><td class="markdownTableBodyNone">O   </td><td class="markdownTableBodyNone">Depend on implementation.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">&lt;UPnP Boolean Type&gt;   </td><td class="markdownTableBodyNone">M   </td><td class="markdownTableBodyNone">-   </td><td class="markdownTableBodyNone">-   </td><td class="markdownTableBodyNone">-   </td><td class="markdownTableBodyNone">Depend on your device implementation.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">&lt;UPnP QueryStateVariable&gt;   </td><td class="markdownTableBodyNone">M   </td><td class="markdownTableBodyNone">-   </td><td class="markdownTableBodyNone">-   </td><td class="markdownTableBodyNone">-   </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">&lt;UPnP Action Arguments Encoding&gt;   </td><td class="markdownTableBodyNone">M   </td><td class="markdownTableBodyNone">Y   </td><td class="markdownTableBodyNone">O   </td><td class="markdownTableBodyNone">O   </td><td class="markdownTableBodyNone">The BaseURL is removed only when the NMPR mode is true. The service descriptions must be relative in the device description.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">&lt;UPnP URI Rules&gt;   </td><td class="markdownTableBodyNone">M   </td><td class="markdownTableBodyNone">Y   </td><td class="markdownTableBodyNone">O/X   </td><td class="markdownTableBodyNone">O   </td><td class="markdownTableBodyNone">There is no limitation for he UDN length. To change the device descriptions and the services, create the new device and start it.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">&lt;UPnP UDN Usage&gt;   </td><td class="markdownTableBodyNone">M   </td><td class="markdownTableBodyNone">Y   </td><td class="markdownTableBodyNone">O   </td><td class="markdownTableBodyNone">O   </td><td class="markdownTableBodyNone">The control point is not renew the subscriptions automatically.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">&lt;UPnP Subscription Renewals&gt;   </td><td class="markdownTableBodyNone">O   </td><td class="markdownTableBodyNone">Y   </td><td class="markdownTableBodyNone">X   </td><td class="markdownTableBodyNone">O   </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">&lt;UPnP Device Handling of SubscriptionRenewals&gt;   </td><td class="markdownTableBodyNone">M   </td><td class="markdownTableBodyNone">Y   </td><td class="markdownTableBodyNone">O   </td><td class="markdownTableBodyNone">O   </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">&lt;UPnP IP Address Rules&gt;   </td><td class="markdownTableBodyNone">M   </td><td class="markdownTableBodyNone">Y   </td><td class="markdownTableBodyNone">O   </td><td class="markdownTableBodyNone">O   </td><td class="markdownTableBodyNone"></td></tr>
</table>
<h1><a class="anchor" id="autotoc_md28"></a>
IPv6</h1>
<p><a class="el" href="namespacemUPnP.html">mUPnP</a> binds all interfaces in the platform when the devices or control points are created, and the IPv6 sockets are created automatically if the interfaces have IPv6 addresses.mUPnP supports IPv4 and IPv6 both as default. If you want to use only IPv6 interfaces, call the following</p>
<p>method before the devices or control points are created.</p>
<div class="fragment"><div class="line">UPnP::SetEnable(UPnP::USE_ONLY_IPV6_ADDR)</div>
</div><!-- fragment --><p>Link local is the default scope for multicasting of <a class="el" href="namespacemUPnP.html">mUPnP</a>. Use UPnP::SetEnable() to change the scope. The following example changes the scope to the site local.</p>
<div class="fragment"><div class="line">UPnP::SetEnable(UPnP::USE_IPV6_SITE_LOCAL_SCOPE)</div>
</div><!-- fragment --><p>On Unix platform, <a class="el" href="namespacemUPnP.html">mUPnP</a> get the local interfaces IPv4 and IPv6 using getifaddrs(). If you want to use <a class="el" href="namespacemUPnP.html">mUPnP</a> with IPv6, please check the function supports IPv6 on your platform. I know that the function doesn’t support IPv6 yet on Redhat 9 and MacOSX 10.2.6.</p>
<h1><a class="anchor" id="autotoc_md29"></a>
Inside mUPnP</h1>
<p>This section describes the inside of <a class="el" href="namespacemUPnP.html">mUPnP</a> for C++.</p>
<h2><a class="anchor" id="autotoc_md30"></a>
Overriding HTTP Service</h2>
<p>The Device class of <a class="el" href="namespacemUPnP.html">mUPnP</a> implements a HTTPRequestListner interface of CyberHTTP package to handle some HTTP requests from the control points. The HTTPRequestListener interface is bellow.</p>
<div class="fragment"><div class="line">class HTTPRequestListener</div>
<div class="line">{</div>
<div class="line">public:</div>
<div class="line">    virtual void httpRequestRecieved(HTTPRequest *httpReq) = 0;</div>
<div class="line">}</div>
</div><!-- fragment --><p>To overide the interface, use CyberHTTP namespace and override the httpRequestRecieved method in your device that is a sub class of the Device class. The following example is a clock device using <a class="el" href="namespacemUPnP.html">mUPnP</a>, and adds the override method to return the presentation page.</p>
<div class="fragment"><div class="line">using namespace CyberHTTP;</div>
<div class="line">const char PRESENTATION_URI[] = &quot;/presentation&quot;;</div>
<div class="line">....</div>
<div class="line">class ClockDevice : public Device, public ActionListener, public QueryListener {</div>
<div class="line">    ....</div>
<div class="line">    void httpRequestRecieved(HTTPRequest *httpReq) {</div>
<div class="line">        string uri = httpReq-&gt;getURI();</div>
<div class="line">        if (uri.find(PRESENTATION_URI) == string::npos) {</div>
<div class="line">            Device::httpRequestRecieved(httpReq);</div>
<div class="line">            return;</div>
<div class="line">        }</div>
<div class="line">        string clockStr = ....;</div>
<div class="line">        string contents;</div>
<div class="line">        contents = &quot;&lt;HTML&gt;&lt;BODY&gt;&lt;H1&gt;&quot;;</div>
<div class="line">        contents += clockStr;</div>
<div class="line">        contents += &quot;&lt;/H1&gt;&lt;/BODY&gt;&lt;/HTML&gt;&quot;;</div>
<div class="line">        HTTPResponse httpRes;</div>
<div class="line">        httpRes.setStatusCode(HTTP::OK_REQUEST);</div>
<div class="line">        httpRes.setContent(contents);</div>
<div class="line">        httpReq-&gt;post(&amp;httpRes);</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md31"></a>
Transitioning From Version 1.2</h1>
<h2><a class="anchor" id="autotoc_md32"></a>
QueryListner</h2>
<p><a class="el" href="namespacemUPnP.html">mUPnP</a> v1.3 has changed the QueryListner interface to return user error infomation and set the listener to the StateVariable instance instead of the Service instance. The difference is bellow.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Version   </th><th class="markdownTableHeadNone">Interface    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">1.2   </td><td class="markdownTableBodyNone">bool queryControlReceived(Service *service, const char *varName, std::string &amp;result)    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">1.3   </td><td class="markdownTableBodyNone">bool queryControlReceived(StateVariable *stateVar)   </td></tr>
</table>
<p>Use StateVariable::getName() to know the variable name, and use StateVariable::setValue() to return the result value. The following sample shows the difference between v1.2 and v1.3.</p>
<p>v1.2: </p><div class="fragment"><div class="line">bool queryControlReceived(Service *service, const char *varName, string &amp;result) {</div>
<div class="line">    result = Clock::GetCurrentTimeString();</div>
<div class="line">    return true;</div>
<div class="line">}</div>
</div><!-- fragment --><p>v1.3: </p><div class="fragment"><div class="line">bool queryControlReceived(StateVariable *stateVar) {</div>
<div class="line">    const char *varName = stateVar-&gt;getName();</div>
<div class="line">    stateVar-&gt;setValue(Clock::GetCurrentTimeString());</div>
<div class="line">    return true;</div>
<div class="line">}</div>
</div><!-- fragment --><p>To set the query listener, use StateVariable:: setQueryListener() instead of <code>Service::setQueryListner()</code>.</p>
<p>However, <code>Service::setQueryListner()</code> that sets the specifed listener to all state variables in the service is not deprecated to ensure the compatibility. The implematation is bellow.</p>
<div class="fragment"><div class="line">void Service::setQueryListener(QueryListener *listener)</div>
<div class="line">{</div>
<div class="line">    ServiceStateTable *stateTable = getServiceStateTable();</div>
<div class="line">    for (int n=0; n&lt; stateTable-&gt;size(); n++) {</div>
<div class="line">        StateVariable *var = stateTable-&gt;getStateVariable(n);</div>
<div class="line">        var-&gt;setQueryListener(listener);</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.12.0 </li>
  </ul>
</div>
</body>
</html>
